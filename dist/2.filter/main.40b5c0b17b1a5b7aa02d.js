!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=90)}({75:function(e,r){e.exports="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nvarying highp vec2 vTextureCoord;\nvarying highp vec2 vertPos;\nuniform float uFlipY;\nvoid main(void){\n  vTextureCoord=aTextureCoord;\n  vertPos=aVertexPosition;\n  gl_Position=vec4((2.*aVertexPosition+vec2(-1.,-1.))*vec2(1.,uFlipY),0.,1.);\n}"},76:function(e,r){e.exports="precision mediump float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvarying vec2 vertPos;\nuniform lowp vec2 uMouse;\nuniform lowp vec2 uSize;\nuniform float uFilter[9];\n\nvoid main(void){\n  vec2 pos=vertPos*uSize;\n  vec2 distVec=pos-uMouse;\n  float distance=length(distVec);\n  if(distance>160.){\n    gl_FragColor=texture2D(uSampler,vTextureCoord);\n  }else if(distance>159.){\n    gl_FragColor=vec4(1.,0.,0.,1.);\n  }else{\n    vec2 offsBlur=vec2(1.,1.)/uSize;\n    vec4 colorSum=vec4(0.);\n    for(int j=-1;j<=1;j++){\n      for(int i=-1;i<=1;i++){\n        colorSum+=texture2D(uSampler,vTextureCoord+offsBlur*vec2(i,j))*uFilter[(j+1)*3+(i+1)];\n      }\n    }\n    gl_FragColor=vec4(colorSum.rgb,1.);\n  }\n}\n\n/*precision mediump float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvarying vec2 vertPos;\nuniform vec2 uMouse;\nuniform vec2 uSize;\nuniform float uFilter[9];\nuniform float uFilterWeight;\n\nfloat CalcGauss(float x,float sigma)\n{\n  float coeff=1./(2.*3.14157*sigma);\n  float expon=-(x*x)/(2.*sigma);\n  return(coeff*exp(expon));\n}\n\nvoid main()\n{\n  vec4 texCol=texture2D(uSampler,vTextureCoord);\n  vec4 gaussCol=vec4(texCol.rgb,1.);\n  vec2 step=1./uSize;\n  const int u_width=2;\n  float u_sigma=1.;\n  for(int j=-u_width;j<=u_width;j++)\n  {\n    for(int i=-u_width;i<=u_width;i++)\n    {\n      vec2 actStep=vec2(float(i)*step.x,float(j)*step.y);\n      float weight=CalcGauss(float(i)/float(u_width),u_sigma);\n      texCol=texture2D(uSampler,vTextureCoord+actStep);\n      gaussCol+=vec4(texCol.rgb*weight,weight);\n      texCol=texture2D(uSampler,vTextureCoord-actStep);\n      gaussCol+=vec4(texCol.rgb*weight,weight);\n    }\n  }\n  gaussCol.rgb/=gaussCol.w;\n  gl_FragColor=vec4(gaussCol.rgb,1.);\n}*/"},90:function(e,r,t){"use strict";t.r(r);function n(e,r,t){var n,o=function(e,r,t){var n=u(e,e.VERTEX_SHADER,r),o=u(e,e.FRAGMENT_SHADER,t),i=e.createProgram();if(e.attachShader(i,n),e.attachShader(i,o),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))return alert("無法初始化著色器程序: "+e.getProgramInfoLog(i)),null;return i}(e,r,t);return{program:o,attribLocations:{vertexPosition:(n=e.getAttribLocation(o,"aVertexPosition"),function(r){e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n)}),textureCoord:function(){var r=e.getAttribLocation(o,"aTextureCoord");return function(t){e.bindBuffer(e.ARRAY_BUFFER,t),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r)}}()},uniformLocations:{flipY:function(){var r=e.getUniformLocation(o,"uFlipY");return function(t){e.uniform1f(r,t)}}(),sampler:function(){var r=e.getUniformLocation(o,"uSampler");return function(t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(r,n)}}(),size:function(){var r=e.getUniformLocation(o,"uSize");return function(t){e.uniform2fv(r,t)}}(),mouse:function(){var r=e.getUniformLocation(o,"uMouse");return function(t){e.uniform2fv(r,t)}}(),filter:function(){var r=e.getUniformLocation(o,"uFilter[0]");return function(t){e.uniform1fv(r,t)}}()}}}function o(e){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),r}function i(e,r,t,n){e.bindFramebuffer(e.FRAMEBUFFER,r),e.viewport(0,0,t,n)}function a(e,r){var t=o(e),n=new Image;return n.onload=function(){e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)},n.src=r,t}function u(e,r,t){var n=e.createShader(r);return e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(alert("編譯著色器時發生錯誤: "+e.getShaderInfoLog(n)),e.deleteShader(n),null)}!function(){var e=document.querySelector("#glcanvas"),r=e.getContext("webgl");if(!r)return void alert("無法初始化WebGL。您的瀏覽器或機器可能不支持它。");var u={filterShader:n(r,t(75),t(76))},f=function(e){var r=[[0,0],[1,0],[1,1],[0,1]].flat(),t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW);var n=[[0,0],[1,0],[1,1],[0,1]].flat(),o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW);var i=[[0,1,3],[1,2,3]].flat(),a=e.createBuffer();return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint8Array(i),e.STATIC_DRAW),{position:t,textureCoord:o,indexLength:i.length}}(r),c=[a(r,"../img/image.7826b8fad510e7131700fc463cce2c7c.jpg")],l=[0,0];e.addEventListener("mousemove",(function(e){l[0]=e.pageX,l[1]=e.pageY}));for(var s=[],v=0;v<2;v++){var m={},d=o(r);m.texture=d,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.canvas.clientWidth,r.canvas.clientHeight,0,r.RGBA,r.UNSIGNED_BYTE,null);var T=r.createFramebuffer();m.framebuffer=T,r.bindFramebuffer(r.FRAMEBUFFER,T),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,d,0),s.push(m)}r.bindFramebuffer(r.FRAMEBUFFER,null),requestAnimationFrame((function e(t){requestAnimationFrame(e),function(e,r,t,n,o,a){e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var u=r.filterShader;e.useProgram(u.program),u.attribLocations.vertexPosition(t.position),u.attribLocations.textureCoord(t.textureCoord),u.uniformLocations.flipY(1),u.uniformLocations.sampler(n[0],0),u.uniformLocations.size([e.canvas.clientWidth,e.canvas.clientHeight]),u.uniformLocations.mouse(o);var f=0,c=a[f%2];i(e,c.framebuffer,e.canvas.width,e.canvas.height);var l=[[-2,-1,0],[-1,1,1],[0,1,2]].flat(),s=l.reduce((function(e,r){return e+r}),0);u.uniformLocations.filter(l.map((function(e){return e/s}))),e.drawElements(e.TRIANGLE_STRIP,t.indexLength,e.UNSIGNED_BYTE,0),u.uniformLocations.sampler(c.texture,0),f++;var v=a[f%2];i(e,v.framebuffer,e.canvas.width,e.canvas.height);var m=[[.111,.111,.111],[.111,.111,.111],[.111,.111,.111]].flat(),d=m.reduce((function(e,r){return e+r}),0);u.uniformLocations.filter(m.map((function(e){return e/d}))),e.drawElements(e.TRIANGLE_STRIP,t.indexLength,e.UNSIGNED_BYTE,0),u.uniformLocations.sampler(v.texture,0),f++,i(e,null,e.canvas.width,e.canvas.height),u.uniformLocations.flipY(-1),e.drawElements(e.TRIANGLE_STRIP,t.indexLength,e.UNSIGNED_BYTE,0)}(r,u,f,c,l,s)}))}()}});